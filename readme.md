> <center><h1>简易Web服务器</h1></center>
> <center>操作系统课程设计</center>
> <center>广东海洋大学阳江校区  计算机科学与工程学院  Jackie</center>
> <center>2024.05.23</center>

## 1 问题描述

Web 浏览器和 Web 服务器使用称为 HTTP（超文本传输协议）的基于文本的协议进行交互。Web 浏览器建立与 Web 服务器的 Internet 连接并使用 HTTP 请求某些内容。Web 服务器响应请求的内容并关闭连接。浏览器读取内容并将其显示在屏幕上。

在这个选题上，你需要实现一个简易的Web服务端用于接收并处理请求，还需要实现一个客户端用于发起并展示请求。

## 2 实现要求

### 2.1 实现基于Socket的TCP请求连接方式

Socket编程是一种连接网络上两个节点以相互通信的方法。一个Socket（节点）侦听 IP 上的特定端口，而另一个Socket则建立连接。当客户端连接到服务器时，服务器形成侦听器套接字。

### 2.2 实现基于多线程的服务器

Web 服务器首次启动时创建固定大小的工作线程池（指定数目的线程）。使用线程池方法，每个线程初始时都会被阻塞，直到有一个 http 请求需要它处理。

因此，如果工作线程多于活动请求，那么某些线程将被阻塞，等待新的 http 请求到达； 如果请求多于工作线程，则需要缓冲这些请求，直到有就绪线程为止。

在你的实现中，必须有一个主线程，它首先创建一个工作线程池，其数量在命令行上指定。然后，主线程负责监听网络接受（accept）新的 http 连接，并将该连接的描述符放入固定大小的缓冲区中。缓冲区中的元素数量也在命令行上指定。请注意，现有的 Web 服务器只有主线程接受连接，然后立即处理该连接；在你的 Web 服务器中，该线程应将连接描述符放入固定大小的缓冲区中，并返回以接受更多连接。
      
>【提示】
> 
> 主线程和工作线程是生产者-消费者关系，并且要求它们对共享缓冲区的访问是同步的。具体来说——
> - 如果缓冲区已满，主线程必须阻塞并等待；
> - 如果缓冲区为空，工作线程必须等待。 

运行时通过命令行参数传递用于设置服务器的线程数目以及缓存的大小，具体的格式如下所示：
      
```shell
  ./server [threads] [buffers]
```
      
比如 `./server 5 10` ，表示为服务器创建5个工作线程，缓存大小设置为10。

### 2.3 实现基于多线程的客户端

你需要实现一个用于发送请求的客户端程序，该程序需要具备多线程的特性，用于实现并发发起请求。你需要按照要求实现两种工作负载用于以不同的方式发送请求：

#### (1) Concurrent Groups (CONCUR)

客户端创建 N 个线程并使用这些线程并发执行 N 个请求；这种行为会永远重复（直到客户端被杀死）。你应该确保 N 个线程彼此重叠发送和等待请求。

当所有 N 个线程收到响应后，线程应重复请求。在任何情况下都不应使用忙等待。（可以使用 `pthread_barrier_wait` 实现此功能）。

#### (2) First-In-First-Out Groups (FIFO)

客户端创建N个线程并使用这些线程执行N个请求；然而，客户端确保请求是按串行顺序发起的，但响应可以按任何顺序发生。具体来说，在一个线程发送其请求并得到响应后，另一个线程才能够执行发送请求。这种行为会永远重复（直到客户端被杀死）。在任何情况下都不应使用忙等待。（可以使用 `信号量` 或 `锁` 实现此功能）。

运行时通过命令行参数传递用于设置客户端的线程数目以及工作负载的方式，具体的格式如下所示：

```shell
  ./client [threads] [workload]
```
比如 `./client 8 0` ，表示为客户端创建8个工作线程，使用CONCUR的方式发送请求（例子中以0和1表示不同的工作负载，具体的区别方式可以自行决定）。

## 3 开发环境
- 操作系统：Ubuntu 22.04.1 LTS (GNU/Linux 5.15.146.1-microsoft-standard-WSL2 x86_64)
- 编程语言：C
- 开发工具：JetBrains CLion 2024.1 RC
- 版本控制：Git

## 4 项目结构

```shell
tree 
# 待补充
```

## 5 任务分解

待补充

table（端 开发任务  进度  状态  备注）